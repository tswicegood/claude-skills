name: Release Skills

on:
  push:
    branches:
      - main
    paths:
      - '*/SKILL.md'
      - '*/references/**'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Create skill files for each skill
        run: |
          # Find all directories containing SKILL.md
          for skill_dir in */; do
            skill_dir=${skill_dir%/}  # Remove trailing slash
            if [ -f "$skill_dir/SKILL.md" ]; then
              echo "Creating skill file for $skill_dir"
              # Create ZIP with the skill directory contents, using .skill extension
              cd "$skill_dir"
              zip -r "../${skill_dir}.skill" . -x "*.git*"
              cd ..
            fi
          done

          # List created skill files
          ls -lh *.skill

      - name: Get current date
        id: date
        run: echo "date=$(date +'%Y-%m-%d %H:%M:%S UTC')" >> $GITHUB_OUTPUT

      - name: Create or Update Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: latest
          name: Latest Skills
          body: |
            # Claude Skills - Latest Release

            Download individual skills as `.skill` files below.

            **Last updated:** ${{ steps.date.outputs.date }}

            ## Available Skills:

            Each `.skill` file contains a complete skill with its `SKILL.md` and any reference materials.

            ## Installation:

            1. Download the desired `.skill` file
            2. Extract to your Claude skills directory
            3. The skill will be available for use with Claude Code

            ---
            *Auto-generated from commit ${{ github.sha }}*
          files: |
            *.skill
          draft: false
          prerelease: false
          fail_on_unmatched_files: true
          overwrite: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
